<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <title>To-Do Dashboard</title>
     <link rel="stylesheet" href="/style.css">
</head>

<body>
     <nav class="navbar">
          <div class="brand">CR To-Do</div>
     </nav>

     <div class="container">
          <div class="search-bar">
               <form action="/search" method="get">
                    <input type="text" name="q" value="<%= query %>" placeholder="Search tasks..." class="search-input">
                    <button type="submit" class="search-btn">Search</button>
               </form>
          </div>
          <div class="header-action">
               <h2>Dashboard</h2>
               <a href="/add-task" class="add-btn">+ Add Task</a>
          </div>
          <form action="/delete-multiple" method="post">
               <table>
                    <thead>
                         <tr>
                              <th></th>
                              <th>Date</th>
                              <th>Task</th>
                              <th>Description</th>
                              <th>Status</th>
                              <th>Actions</th>
                         </tr>
                    </thead>
                    <tbody>
                         <% if (result.length>0) { %>
                              <% result.forEach(function(task){ %>
                                   <tr>
                                        <td><input type="checkbox" class="row-check" name="selectedTasks"
                                                  value="<%= task._id %>"></td>
                                        <td>
                                             <%= task.taskDate %>
                                        </td>
                                        <td>
                                             <%= task.taskTitle %>
                                        </td>
                                        <td>
                                             <%= task.taskDescription %>
                                        </td>
                                        <td>
                                             <%= task.taskStatus %>
                                        </td>
                                        <td>
                                             <a href="/update-task/<%= task._id %>" class="icon-btn edit">‚úèÔ∏è</a>
                                             <a href="/delete/<%= task._id %>" class="icon-btn delete">üóëÔ∏è</a>
                                        </td>
                                   </tr>
                                   <% }) %>
                                        <% } else { %>
                                             <tr>
                                                  <td colspan="6" style="text-align:center;">No tasks found</td>
                                             </tr>
                                             <% } %>
                    </tbody>
               </table>
               <button type="submit" id="deleteSelectedBtn" class="btn btn-delete-selected" style="display:none;">
                    Delete Selected
               </button>
          </form>
          <div class="pagination">
               <% if (totalPages>1) { %>
                    <ul>
                         <% if (currentPage>1) { %>
                              <li><a href="/?page=<%= currentPage - 1 %>">Previous</a></li>
                              <% } %>
                                   <% for (let i=1; i<=totalPages; i++) { %>
                                        <li class="<%= currentPage === i ? 'active' : '' %>">
                                             <a href="/?page=<%= i %>">
                                                  <%= i %>
                                             </a>
                                        </li>
                                        <% } %>
                                             <% if (currentPage<totalPages) { %>
                                                  <li><a href="/?page=<%= currentPage + 1 %>">Next</a></li>
                                                  <% } %>
                    </ul>
                    <% } %>
          </div>
     </div>

     <script>
          const checkboxes = document.querySelectorAll('.row-check');
          const deleteBtn = document.getElementById('deleteSelectedBtn');
          function toggleDeleteBtn() {
               const checked = document.querySelectorAll('.row-check:checked').length;
               deleteBtn.style.display = checked > 1 ? 'inline-block' : 'none';
          }
          checkboxes.forEach(cb => cb.addEventListener('change', toggleDeleteBtn));
          toggleDeleteBtn();
     </script>
</body>

</html>